<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCODM | Official League</title>
    <link rel="icon" type="image/png" href="iconoweb.png">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --y: #F4CB33; --bg: #050505; --orange: #ff9800; --green: #4CAF50; }
        body { background: var(--bg); color: white; font-family: Arial, sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        nav { width: 100%; background: rgba(15,15,15,0.95); padding: 15px 0; display: flex; justify-content: space-around; border-bottom: 2px solid var(--y); position: fixed; top: 0; z-index: 1000; }
        
        .hero-banner { margin-top: 60px; width: 100%; max-width: 1000px; height: 40vh; background: url('gif1.gif') no-repeat center center; background-size: contain; }

        .content { width: 90%; max-width: 800px; padding: 30px 0; text-align: center; }
        
        .card { background: #0d0d0d; padding: 20px; border-left: 4px solid var(--y); margin-bottom: 20px; text-align: left; }
        
        /* TABLA PREMIOS */
        .puntos-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .puntos-table th { background: var(--y); color: black; padding: 10px; }
        .puntos-table td { padding: 10px; border: 1px solid #222; text-align: center; }

        .btn-pay { background: var(--y); color: black; padding: 15px; border: none; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; text-decoration: none; display: block; }
        
        .registro-box { background: #111; padding: 25px; border: 1px solid #222; display: none; text-align: left; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid #444; color: white; box-sizing: border-box; }

        /* LISTA */
        .lista-container { width: 100%; margin-top: 40px; background: #0a0a0a; padding: 15px; border-radius: 5px; }
        .tabla-inscritos { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .tabla-inscritos th { text-align: left; color: var(--y); border-bottom: 1px solid #333; padding: 8px; }
        .tabla-inscritos td { padding: 10px; border-bottom: 1px solid #111; font-size: 14px; }

        .status-pend { color: var(--orange); font-weight: bold; }
        .status-conf { color: var(--green); font-weight: bold; }

        .politica-box { font-size: 12px; color: #888; margin: 15px 0; text-align: left; background: #151515; padding: 10px; border: 1px solid #333; }
    </style>
</head>
<body>

    <nav>
        <div style="font-weight:900; letter-spacing:2px;">T<span style="color:var(--y)">CODM</span></div>
        <div id="count-nav" style="color:var(--y); font-weight:bold;">SQUADS: 0/25</div>
    </nav>

    <section class="hero-banner"></section>

    <main class="content">
        <div class="card">
            <h2 style="color:var(--y); margin-top:0;">RECOMPENSA TOTAL: $100 USD</h2>
            <p>Se jugar√°n <strong>3 partidas consecutivas</strong>. Los premios se reparten a los 3 jugadores/squads con mayor n√∫mero de Kills acumuladas.</p>
            <table class="puntos-table">
                <tr><th>PUESTO</th><th>RECOMPENSA</th></tr>
                <tr><td>ü•á Top 1 Kills</td><td>$60.00 USD</td></tr>
                <tr><td>ü•à Top 2 Kills</td><td>$25.00 USD</td></tr>
                <tr><td>ü•â Top 3 Kills</td><td>$15.00 USD</td></tr>
            </table>
            <p style="font-size:13px;">* Inscripci√≥n por Squad: <strong>$5.46 USD</strong></p>
        </div>

        <div id="pago-seccion">
            <div class="politica-box">
                <strong>POL√çTICA DE NO REEMBOLSO:</strong><br>
                Al realizar el pago, aceptas que no habr√° devoluciones. El pozo se reserva para los premios y la log√≠stica. Es responsabilidad de la Squad asistir puntualmente a los 3 juegos. La inasistencia resultar√° en la p√©rdida del cupo sin derecho a reclamo.
                <br><br>
                <input type="checkbox" id="acepto" style="width:auto;"> He le√≠do y acepto la pol√≠tica de asistencia y no reembolso.
            </div>
            <button class="btn-pay" onclick="validarPago()">PAGAR SLOT ($5.46)</button>
        </div>

        <div id="registro-box" class="registro-box">
            <h3 style="color:var(--green)">‚úì PAGO DETECTADO</h3>
            <p>Registra a tu equipo. Tu estado aparecer√° como <span class="status-pend">PENDIENTE</span> hasta que validemos tu pago manualmente.</p>
            <input type="text" id="teamName" placeholder="Nombre de la Squad">
            <input type="text" id="p1" placeholder="Capit√°n (ID)">
            <input type="text" id="p2" placeholder="Jugador 2">
            <input type="text" id="p3" placeholder="Jugador 3">
            <input type="text" id="p4" placeholder="Jugador 4">
            <button class="btn-pay" onclick="enviarFirebase()">FINALIZAR REGISTRO</button>
        </div>

        <div class="lista-container">
            <h3 id="display-cupos">SQUADS REGISTRADAS: 0/25</h3>
            <table class="tabla-inscritos">
                <thead>
                    <tr><th>SQUAD</th><th>L√çDER</th><th>ESTADO</th></tr>
                </thead>
                <tbody id="tabla-body"></tbody>
            </table>
        </div>
    </main>

    <script>
        const firebaseConfig = { databaseURL: "https://tcodm-e4147-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function validarPago() {
            if(!document.getElementById('acepto').checked) {
                alert("Debes aceptar la pol√≠tica de no reembolso.");
                return;
            }
            window.location.href = "https://buy.stripe.com/4gM8wHey05kI44CfbN4ow00";
        }

        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('status') === 'success') {
                document.getElementById('pago-seccion').style.display = 'none';
                document.getElementById('registro-box').style.display = 'block';
            }
            escucharBaseDeDatos();
        };

        function enviarFirebase() {
            const team = document.getElementById('teamName').value;
            const cap = document.getElementById('p1').value;
            if(!team || !cap) return alert("Faltan datos");

            database.ref('inscripciones/' + team).set({
                capitan: cap,
                integrantes: [document.getElementById('p2').value, document.getElementById('p3').value, document.getElementById('p4').value],
                estado: "PENDIENTE", // T√∫ cambias esto a "CONFIRMADO" en Firebase
                fecha: new Date().toLocaleString()
            }).then(() => {
                alert("Registro enviado. Espera la confirmaci√≥n del admin.");
                window.location.href = "index.html";
            });
        }

        function escucharBaseDeDatos() {
            database.ref('inscripciones').on('value', (snapshot) => {
                const body = document.getElementById('tabla-body');
                const countNav = document.getElementById('count-nav');
                const displayCupos = document.getElementById('display-cupos');
                body.innerHTML = "";
                let confirmados = 0;
                let total = 0;

                snapshot.forEach((child) => {
                    total++;
                    const data = child.val();
                    const isConf = data.estado === "CONFIRMADO";
                    if(isConf) confirmados++;

                    body.innerHTML += `<tr>
                        <td>${child.key}</td>
                        <td>${data.capitan}</td>
                        <td class="${isConf ? 'status-conf' : 'status-pend'}">${data.estado}</td>
                    </tr>`;
                });

                countNav.innerText = `SQUADS: ${confirmados}/25`;
                displayCupos.innerText = `SQUADS CONFIRMADAS: ${confirmados}/25`;
                
                if(confirmados >= 25) {
                    document.getElementById('pago-seccion').innerHTML = "<h3 style='color:red'>CUPOS AGOTADOS</h3>";
                }
            });
        }
    </script>
</body>
</html>
